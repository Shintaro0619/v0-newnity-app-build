# Newnity エンドツーエンドテストチェックリスト

## 事前準備

### 1. MetaMask設定
- [ ] MetaMaskがインストールされている
- [ ] Base Sepoliaネットワークが追加されている
- [ ] Base Sepolia ETH（ガス代用）が0.01 ETH以上ある

**Base Sepolia Faucet:**
- https://www.coinbase.com/faucets/base-ethereum-goerli-faucet

### 2. 環境確認
- [ ] データベースがリセットされている（3ユーザー、3キャンペーン、3Pledge）
- [ ] アプリケーションが起動している
- [ ] コンソールにエラーがない

---

## テストフロー

### Test 1: ウォレット接続

**目的:** Web3プロバイダーが正常に動作することを確認

**手順:**
1. ホームページ（`/`）にアクセス
2. 右上の「Get Involved」ボタンをクリック
3. MetaMaskポップアップが表示される
4. 「接続」をクリック
5. ウォレットアドレスが表示される

**期待される結果:**
- ✅ MetaMaskが正常に接続される
- ✅ ウォレットアドレスが画面に表示される
- ✅ Base Sepoliaネットワークが選択されている

**トラブルシューティング:**
- MetaMaskが反応しない → ページをリロード
- ネットワークが違う → MetaMaskでBase Sepoliaに切り替え

---

### Test 2: テストUSDC取得

**目的:** Test USDC Faucetが正常に動作することを確認

**手順:**
1. `/test`ページにアクセス
2. 「Get 1000 Test USDC」ボタンをクリック
3. MetaMaskで取引を承認
4. トランザクションが完了するまで待つ（1-2分）
5. 残高が1000 USDCになることを確認

**期待される結果:**
- ✅ Faucetトランザクションが成功
- ✅ USDC残高が1000になる
- ✅ 成功メッセージが表示される

**確認方法:**
\`\`\`
MetaMask → Assets → USDC残高を確認
\`\`\`

**トラブルシューティング:**
- トランザクションが失敗 → ガス代（ETH）が不足していないか確認
- 残高が更新されない → ページをリロード

---

### Test 3: キャンペーン作成

**目的:** ブロックチェーンとデータベースの両方にキャンペーンが保存されることを確認

**手順:**
1. `/create`ページにアクセス
2. キャンペーン情報を入力:
   - Title: "Test Campaign from Wallet"
   - Description: "This is a test campaign"
   - Goal: 500 USDC
   - Duration: 30 days
   - Category: Games
3. 「Create Campaign」ボタンをクリック
4. MetaMaskで取引を承認
5. トランザクションが完了するまで待つ
6. キャンペーン詳細ページにリダイレクトされる

**期待される結果:**
- ✅ スマートコントラクトにキャンペーンが作成される
- ✅ データベースにメタデータが保存される
- ✅ キャンペーン詳細ページが表示される
- ✅ Goal: 500 USDC、Raised: 0 USDCが表示される

**確認方法:**
\`\`\`
1. Basescan でトランザクションを確認
2. ホームページでキャンペーンが表示されるか確認
\`\`\`

**トラブルシューティング:**
- トランザクションが失敗 → コンソールのエラーメッセージを確認
- データベースに保存されない → API routeのログを確認

---

### Test 4: Pledge機能

**目的:** USDC承認とPledgeの2ステップフローが正常に動作することを確認

**手順:**
1. 作成したキャンペーンの詳細ページにアクセス
2. 「Back This Project」ボタンをクリック
3. Pledge額を入力: 100 USDC
4. 「Approve USDC」ボタンをクリック
5. MetaMaskで承認トランザクションを確認
6. 承認完了後、「Pledge」ボタンをクリック
7. MetaMaskでPledgeトランザクションを確認
8. トランザクション完了を待つ

**期待される結果:**
- ✅ USDC承認トランザクションが成功
- ✅ Pledgeトランザクションが成功
- ✅ Raised額が100 USDCに更新される
- ✅ Backers数が1に更新される
- ✅ 成功メッセージが表示される

**確認方法:**
\`\`\`
1. キャンペーンページをリロード
2. Raised: 100 USDC / 500 USDC が表示される
3. Progress bar が 20% になる
\`\`\`

**トラブルシューティング:**
- 承認が失敗 → USDC残高を確認
- Pledgeが失敗 → 承認額が十分か確認
- 金額が更新されない → ページをリロード

---

### Test 5: 複数回Pledge

**目的:** 同じキャンペーンに複数回Pledgeできることを確認

**手順:**
1. 同じキャンペーンで再度「Back This Project」をクリック
2. 200 USDCを入力
3. 承認とPledgeを実行

**期待される結果:**
- ✅ 2回目のPledgeが成功
- ✅ Raised額が300 USDCに更新される（100 + 200）
- ✅ 同じバッカーからの複数Pledgeが記録される

---

### Test 6: キャンペーン成功シナリオ

**目的:** 目標額達成後のFinalize機能を確認

**手順:**
1. さらに200 USDCをPledge（合計500 USDC = 目標達成）
2. キャンペーン期限を待つ（テスト用に短い期限を設定）
3. 「Finalize Campaign」ボタンをクリック
4. MetaMaskでトランザクションを承認

**期待される結果:**
- ✅ キャンペーンがFinalizeされる
- ✅ クリエイターに資金が送金される（95% = 475 USDC）
- ✅ プラットフォームに手数料が送金される（5% = 25 USDC）
- ✅ ステータスが「Successful」に変わる

**確認方法:**
\`\`\`
1. クリエイターのUSDC残高を確認
2. プラットフォームウォレットの残高を確認
\`\`\`

---

### Test 7: キャンペーン失敗シナリオ

**目的:** 目標未達成時のRefund機能を確認

**手順:**
1. 新しいキャンペーンを作成（Goal: 1000 USDC）
2. 100 USDCをPledge
3. キャンペーン期限を待つ
4. 「Finalize Campaign」をクリック
5. 「Refund」ボタンをクリック
6. MetaMaskでトランザクションを承認

**期待される結果:**
- ✅ キャンペーンがFinalizeされる
- ✅ ステータスが「Failed」に変わる
- ✅ Refundトランザクションが成功
- ✅ バッカーに100 USDCが返金される

**確認方法:**
\`\`\`
1. バッカーのUSDC残高が元に戻る
2. キャンペーンページに「Refunded」と表示される
\`\`\`

---

## テスト完了チェックリスト

### 基本機能
- [ ] ウォレット接続
- [ ] Test USDC取得
- [ ] キャンペーン作成
- [ ] Pledge（1回目）
- [ ] Pledge（2回目）

### 高度な機能
- [ ] キャンペーン成功時のFinalize
- [ ] キャンペーン失敗時のRefund
- [ ] 複数キャンペーンの管理

### UI/UX
- [ ] ローディング状態が表示される
- [ ] エラーメッセージが明確
- [ ] 成功メッセージが表示される
- [ ] トランザクション進行状況が分かる

### パフォーマンス
- [ ] ページ読み込みが速い
- [ ] トランザクション確認が適切
- [ ] データ更新がリアルタイム

---

## 既知の問題

### 解決済み
- ✅ React key警告（修正済み）
- ✅ WalletConnect URL警告（修正済み）
- ✅ Neon SQL構文エラー（修正済み）

### 未解決
- なし

---

## 次のステップ

テスト完了後:
1. バグ修正
2. UI/UXポリッシュ
3. ダミーデータ追加
4. ドキュメント最終確認
5. デモ動画作成
6. Base Batches提出
